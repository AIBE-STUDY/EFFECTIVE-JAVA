# 88. readObject ë©”ì„œë“œëŠ” ë°©ì–´ì ìœ¼ë¡œ ì‘ì„±í•˜ë¼

## 0 ì‹œì‘ í•˜ê¸° ì „, `readObject`ì™€ ì—­ì§ë ¬í™” í•µì‹¬ ìš”ì•½

```mermaid
%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#f0f8ff', 'primaryTextColor': '#000', 'primaryBorderColor': '#7570b3', 'lineColor': '#333', 'edgeLabelBackground':'#fff', 'clusterBkg': '#fcfcfc'}}}%%
graph TD
    subgraph ì—­ì§ë ¬í™” ê³¼ì •
        A[ByteStream-->íŒŒì¼/ë„¤íŠ¸ì›Œí¬] --> B{ObjectInputStream};
        B -- readObject() í˜¸ì¶œ --> C[ê°ì²´ ìƒì„± í”„ë¡œì„¸ìŠ¤];
        C -- ê¸°ë³¸ ì—­ì§ë ¬í™” --> D[1.ê°ì²´ ë©”ëª¨ë¦¬ í• ë‹¹<br>2.ìŠ¤íŠ¸ë¦¼ ë°ì´í„°ë¡œ<br>í•„ë“œ ê°’ ì±„ìš°ê¸°<br>->ìƒì„±ì ì½”ë“œ ì‹¤í–‰ ì•ˆ í•¨!];
        C -- ì»¤ìŠ¤í…€ readObject() êµ¬í˜„ ì‹œ --> E[ê°œë°œìê°€ ì •ì˜í•œ<br>readObject ë©”ì„œë“œ ì‹¤í–‰];
        D --> F[ê°ì²´ ë³µì› ì™„ë£Œ-ì ì¬ì  ìœ„í—˜!];
        E --> G[ê°ì²´ ë³µì› ì™„ë£Œ-ì•ˆì „í•˜ê²Œ êµ¬í˜„ ì‹œ];
    end

    subgraph í´ë˜ìŠ¤ ì •ì˜
        H[MyClass] -- êµ¬í˜„ --> I(Serializable);
        H -. ì •ì˜ ê°€ëŠ¥ .-> J["private void readObject(...)"];
    end

    style F fill:#ffcccc,stroke:#a00
    style G fill:#ccffcc,stroke:#0a0
    style J fill:#ccf,stroke:#333,stroke-width:2px
```

### í•µì‹¬ í¬ì¸íŠ¸

* **`readObject`ì˜ ì—­í• **
  * ì—­ì§ë ¬í™” ê³¼ì •ì—ì„œ ë°”ì´íŠ¸ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œë¶€í„° ê°ì²´ì˜ ìƒíƒœë¥¼ ì½ì–´ì™€ ë©”ëª¨ë¦¬ì— ê°ì²´ë¥¼ **ì¬êµ¬ì„±(ìƒì„±)** í•˜ëŠ” í•µì‹¬ ë©”ì»¤ë‹ˆì¦˜
* **ê¸°ë³¸ ë™ì‘:**
  * ê°œë°œìê°€ `readObject` ë©”ì„œë“œë¥¼ ë”°ë¡œ ì •ì˜í•˜ì§€ ì•Šìœ¼ë©´, ìë°”ëŠ” 'ê¸°ë³¸ ì—­ì§ë ¬í™”' ìˆ˜í–‰
  * ê°ì²´ ë©”ëª¨ë¦¬ í• ë‹¹ í›„, ìŠ¤íŠ¸ë¦¼ì— ì €ì¥ëœ í•„ë“œ ê°’ì„ í•´ë‹¹ í•„ë“œì— **ì§ì ‘** ì±„ì›Œ ë„£ìŒ
  * **ë§¤ìš° ì¤‘ìš”:** ì´ ê³¼ì •ì—ì„œ **í´ë˜ìŠ¤ì˜ ìƒì„±ìëŠ” í˜¸ì¶œë˜ì§€ ì•ŠìŒ!**
* **ì»¤ìŠ¤í…€ `readObject`**
  * í´ë˜ìŠ¤ ë‚´ì— `private void readObject(ObjectInputStream in)` ë©”ì„œë“œë¥¼ ì •ì˜í•˜ë©´, ê¸°ë³¸ ì—­ì§ë ¬í™” ëŒ€ì‹  ì´ ë©”ì„œë“œê°€ í˜¸ì¶œë¨.
  * ê°œë°œìê°€ ê°ì²´ ë³µì› ê³¼ì •ì„ ì§ì ‘ ì œì–´ ê°€ëŠ¥.
* **ë¬¸ì œì˜ ê·¼ì›**
  * ê¸°ë³¸ ì—­ì§ë ¬í™”ëŠ” ìƒì„±ìë¥¼ ê±°ì¹˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ìƒì„±ìì— êµ¬í˜„ëœ **ìœ íš¨ì„± ê²€ì‚¬ë‚˜ ë°©ì–´ ë¡œì§ì´ ì ìš©ë˜ì§€ ì•ŠìŒ.**
  * ì´ê²ƒì´ Item 88ì—ì„œ ë‹¤ë£¨ëŠ” ë³´ì•ˆ ì·¨ì•½ì ì˜ ì‹œì‘ì .

\
\


***

## 1. ì™œ `readObject`ëŠ” ë°©ì–´ì ìœ¼ë¡œ ì‘ì„±í•´ì•¼ í•˜ëŠ”ê°€? ğŸ¤” (ê¸°ë³¸ ì—­ì§ë ¬í™”ì˜ ìœ„í—˜ì„±)

### **í•µì‹¬ ë¬¸ì œ**: ì—­ì§ë ¬í™”ëŠ” ê°ì²´ ìƒì„±ì˜ 'ë‹¤ë¥¸ ê²½ë¡œ'ì´ë©°, ê¸°ë³¸ì ìœ¼ë¡œ **ìƒì„±ìì˜ ì•ˆì „ì¥ì¹˜ë¥¼ ìš°íšŒ**

\


> **ì§ë ¬í™”ëŠ” ìƒì„±ìë¥¼ 'ê±´ë„ˆë›°ëŠ”' ë¬¸**

#### ì •ìƒì ì¸ ì…ì£¼(ê°ì²´ ìƒì„±) ì ˆì°¨

* ìš°ë¦¬ê°€ ì§‘(ê°ì²´)ì„ ì§€ì„ ë•Œ, ë³´í†µ ì •ë¬¸(ìƒì„±ì)ì„ í†µí•´ ë“¤ì–´ê°€ë©´ì„œ í•„ìš”í•œ ê²€ì‚¬(ìœ íš¨ì„± ê²€ì‚¬)ë¥¼ í•˜ê³ , ì¤‘ìš”í•œ ë¬¼ê±´(ë‚´ë¶€ ë°ì´í„°)ì€ ì•ˆì „í•˜ê²Œ ë³´ê´€(ë°©ì–´ì  ë³µì‚¬)í•˜ëŠ” ê·œì¹™ì„ ì •í•´ ë†“ìŠµë‹ˆë‹¤

#### íŠ¹ë³„í•œ 'ë’·ë¬¸'(`readObject` ë©”ì»¤ë‹ˆì¦˜)ì„ ì‚¬ìš©

* ê·¸ëŸ°ë° íŒŒì¼ì´ë‚˜ ë„¤íŠ¸ì›Œí¬ë¡œë¶€í„° ì§ë ¬í™”ëœ ë°ì´í„°ë¥¼ í†µí•´ ì§‘ì„ 'ë³µêµ¬'(ì—­ì§ë ¬í™”)í•  ë•ŒëŠ”, ì •ë¬¸(ìƒì„±ì)ì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
* ëŒ€ì‹ , ì„¤ê³„ë„(ì§ë ¬í™”ëœ ë°ì´í„°)ë¥¼ ë³´ê³  ì§ì ‘ ê°€êµ¬(í•„ë“œ ê°’)ë¥¼ ë°°ì¹˜í•˜ëŠ” íŠ¹ë³„í•œ 'ë’·ë¬¸'ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤.

#### **ë°”ë¡œ ì´ ì ì´ ë¬¸ì œ**

* ë’·ë¬¸ìœ¼ë¡œ ë“¤ì–´ì˜¤ë©´ ì •ë¬¸ì—ì„œ í•˜ë˜ ê²€ì‚¬ë‚˜ ì•ˆì „ ì¡°ì¹˜ë¥¼ ê±°ì¹˜ì§€ ì•Šê²Œ ë¨.
* ë”°ë¼ì„œ ìƒì„±ìì— ì•„ë¬´ë¦¬ íŠ¼íŠ¼í•œ ì•ˆì „ì¥ì¹˜ë¥¼ ë§ˆë ¨í–ˆë”ë¼ë„, ì—­ì§ë ¬í™”ë¼ëŠ” ê²½ë¡œë¥¼ í†µí•´ ë“¤ì–´ì˜¤ë©´ ì´ ì¥ì¹˜ë“¤ì´ ì‘ë™í•˜ì§€ ì•Šì•„ ìœ„í—˜ì— ë…¸ì¶œ

\


### **ë°œìƒ ê°€ëŠ¥í•œ ê³µê²© ìœ í˜• (ë’·ë¬¸ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ìœ„í—˜)**

```mermaid
%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#f0f8ff', 'primaryTextColor': '#000', 'primaryBorderColor': '#7570b3', 'lineColor': '#333', 'edgeLabelBackground':'#fff', 'clusterBkg': '#fcfcfc'}}}%%
graph TD
    A["ì—­ì§ë ¬í™” ê³µê²© ìœ í˜•"] --> B["ê³µê²© 1: ë¶ˆë³€ì‹(ê·œì¹™) ìœ„ë°˜ ğŸ“œ<br>(ì˜ëª»ëœ ìƒíƒœì˜ ê°ì²´ ìƒì„±)"];
    A --> C["ê³µê²© 2: ë¶ˆë³€ì„±(ìƒíƒœ) í›¼ì† ğŸ”“<br>(ë‚´ë¶€ ìƒíƒœ ì™¸ë¶€ ë…¸ì¶œ/ìˆ˜ì •)"];

    style A fill:#ffcccc,stroke:#a00,stroke-width:2px
    style B fill:#fff0f0,stroke:#a00
    style C fill:#fff0f0,stroke:#a00
```

```mermaid
%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#f0f8ff', 'primaryTextColor': '#000', 'primaryBorderColor': '#7570b3', 'lineColor': '#333', 'edgeLabelBackground':'#fff', 'clusterBkg': '#fcfcfc'}}}%%
graph TD

    subgraph "ê³µê²© 1 ìƒì„¸"
        direction LR
        B1[ì¡°ì‘ëœ<br>ë°”ì´íŠ¸ ìŠ¤íŠ¸ë¦¼] --> B2{ê¸°ë³¸ readObject<br>ê²€ì¦ ì—†ìŒ};
        B2 --> B3[ê°ì²´ ìƒì„±<br>ë‚´ë¶€ ê·œì¹™ ìœ„ë°˜!];
        B_EX[("ì˜ˆ: ì‹œì‘ > ì¢…ë£Œ ì¸<br>ê¸°ê°„(Period) ê°ì²´")]; B3 -.-> B_EX;
    end

    style B3 fill:#ffcccc,stroke:#a00
```

```mermaid
%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#f0f8ff', 'primaryTextColor': '#000', 'primaryBorderColor': '#7570b3', 'lineColor': '#333', 'edgeLabelBackground':'#fff', 'clusterBkg': '#fcfcfc'}}}%%
graph TD

    subgraph "ê³µê²© 2 ìƒì„¸"
        direction LR
        C1[ì¡°ì‘ëœ<br>ë°”ì´íŠ¸ ìŠ¤íŠ¸ë¦¼<br>+ ë‚´ë¶€ ì°¸ì¡° ì •ë³´] --> C2{readObject};
        C2 --> C3[ì •ìƒ ê°ì²´ ìƒì„±];
        C2 --> C4[ê³µê²©ì:<br>ë‚´ë¶€ ê°€ë³€ ê°ì²´<br>ì°¸ì¡° íšë“!];
        C4 --> C5{ì™¸ë¶€ì—ì„œ<br>ë‚´ë¶€ ê°ì²´ ìˆ˜ì •};
        C5 --> C6[ê°ì²´ ë‚´ë¶€ ìƒíƒœ<br>ë³€ê²½ë¨! -> ë¶ˆë³€ì„± ê¹¨ì§];
        C_EX[("ì˜ˆ: ì™¸ë¶€ì—ì„œ<br>Period ê°ì²´ì˜<br>Date ë³€ê²½")]; C6 -.-> C_EX;
    end

    style C4 fill:#ffcccc,stroke:#a00
    style C6 fill:#ffcccc,stroke:#a00
```

\


### 1. **ê³µê²© 1: ë¶ˆë³€ì‹(Invariant) ê¹¨ëœ¨ë¦¬ê¸°**

#### **ì›ë¦¬**

* ê³µê²©ìê°€ **ê°ì²´ê°€ ë‚´ë¶€ì ìœ¼ë¡œ ì§€ì¼œì•¼ í•˜ëŠ” ë°ì´í„° ì¼ê´€ì„± ê·œì¹™**ì„ ìœ„ë°˜í•˜ëŠ” 'ì„¤ê³„ë„'(ë°”ì´íŠ¸ ìŠ¤íŠ¸ë¦¼)ë¥¼ ì˜ë„ì ìœ¼ë¡œ ì œì‹œ
  * ì˜ˆ: íŠ¹ì • ìˆ«ì í•„ë“œëŠ” ì–‘ìˆ˜ì—¬ì•¼ í•œë‹¤, ì–´ë–¤ ì»¬ë ‰ì…˜ì€ ë¹„ì–´ìˆìœ¼ë©´ ì•ˆ ëœë‹¤ ë“± í´ë˜ìŠ¤ ì„¤ê³„ ì‹œ ì •ì˜ëœ ì œì•½ ì¡°ê±´

#### **ê²°ê³¼**

* 'ë’·ë¬¸'(`readObject`)ì€ ì •ë¬¸ì˜ ê²€ì‚¬(ìƒì„±ì ìœ íš¨ì„± ê²€ì‚¬)ë¥¼ ìˆ˜í–‰í•˜ì§€ ì•ŠìŒ
* **ì •ìƒì ì¸ ì •ë¬¸(ìƒì„±ì)ìœ¼ë¡œëŠ” ë§Œë“¤ ìˆ˜ ì—†ëŠ”, ê·œì¹™ ìœ„ë°˜ ìƒíƒœì˜ 'ì˜ëª» ì§€ì–´ì§„ ì§‘'(ê°ì²´)** ê°€ ë§Œë“¤ì–´ì§.

\


### 2. **ê³µê²© 2: ë¶ˆë³€ì„±(Immutability) ê¹¨ëœ¨ë¦¬ê¸°**

#### **ì›ë¦¬:**

1. ì§‘(ê°ì²´) ë‚´ë¶€ì— **ì™¸ë¶€ì¸ì´ ë§Œì§€ë©´ ì•ˆ ë˜ëŠ”, ë‚´ìš© ë³€ê²½ì´ ê°€ëŠ¥í•œ ì¤‘ìš”í•œ ë¬¼ê±´**(ì˜ˆ: `private` í•„ë“œì¸ `List`, `Map`, `Date` ê°ì²´ ë“±)ì´ ìˆë‹¤ê³  ê°€ì •.
2. ê³µê²©ìê°€ ì •ìƒ 'ì„¤ê³„ë„'(ë°”ì´íŠ¸ ìŠ¤íŠ¸ë¦¼) ë’¤ì—, ì´ **ë‚´ë¶€ì˜ ë³€ê²½ ê°€ëŠ¥ ë¬¼ê±´**ì„ ì§ì ‘ ê°€ë¦¬í‚¤ëŠ” **'ì—´ì‡  ë³µì œ ì •ë³´'(íŠ¹ë³„í•œ ì°¸ì¡° ë°ì´í„°)** ì¶”ê°€.
3. ì¡°ì‘ëœ ì„¤ê³„ë„ë¡œ ì§‘ì„ ë³µêµ¬(ì—­ì§ë ¬í™”).

#### **ê²°ê³¼:**

1. ì§‘(ê°ì²´) ìì²´ëŠ” ê²‰ë³´ê¸°ì— ì •ìƒì ìœ¼ë¡œ ë³µêµ¬ë¨.
2. í•˜ì§€ë§Œ ê³µê²©ìëŠ” 'ì—´ì‡  ë³µì œ ì •ë³´'(ì¶”ê°€ ë°ì´í„°)ë¥¼ ì´ìš©í•´, **ì§‘ ë‚´ë¶€ì˜ ë³€ê²½ ê°€ëŠ¥ ë¬¼ê±´ì— ëŒ€í•œ 'ë³µì œ ì—´ì‡ '(ì§ì ‘ì ì¸ ì°¸ì¡°)** ë¥¼ íšë“.
3. ê³µê²©ìëŠ” ì´ ë³µì œ ì—´ì‡ ë¡œ **ì™¸ë¶€ì—ì„œ ì§‘ ë‚´ë¶€ ë¬¼ê±´ì˜ ìƒíƒœë¥¼ ì„ì˜ë¡œ ë³€ê²½ ê°€ëŠ¥.** â†’ **'ì•ˆì „í•˜ê²Œ ë³´ê´€ë˜ì–´ì•¼ í• ' ë‚´ë¶€ ìƒíƒœê°€ ì™¸ë¶€ì—ì„œ ë³€ê²½ë˜ê±°ë‚˜, 'ë¶ˆë³€'ìœ¼ë¡œ ì„¤ê³„ëœ ê°ì²´ê°€ ì‚¬ì‹¤ì€ ë³€í•  ìˆ˜ ìˆê²Œ ë¨!**

### **ê¸°ì–µí•˜ì„¸ìš”**

> `Serializable` ê°ì²´ì˜ ì—­ì§ë ¬í™”ëŠ” **ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” ë°ì´í„°**ë¡œë¶€í„° ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ê³¼ì •ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. `readObject`ëŠ” ì´ ê³¼ì •ì˜ **ìµœì¢… ë°©ì–´ì„ **ì…ë‹ˆë‹¤.

\
\


***

## 2. ë¯¸í¡í•œ í•´ê²°ì±…: ìœ íš¨ì„± ê²€ì‚¬ë§Œìœ¼ë¡œëŠ” ë¶€ì¡±í•˜ë‹¤! ğŸ¤”

### **ì‹œë„:** `readObject` ë©”ì„œë“œë¥¼ êµ¬í˜„í•˜ì—¬ `defaultReadObject()` í˜¸ì¶œ í›„, ìƒì„±ìì²˜ëŸ¼ ìœ íš¨ì„± ê²€ì‚¬ ë¡œì§ë§Œ ì¶”ê°€.

```java
// ê°œë… ì½”ë“œ (Code 88-3 ìŠ¤íƒ€ì¼)
private void readObject(ObjectInputStream s) throws IOException, ClassNotFoundException {
    s.defaultReadObject(); // í•„ë“œ ê°’ ì½ê¸°

    // ê°ì²´ ë‚´ë¶€ ê·œì¹™ ê²€ì‚¬ (ì˜ˆ: ì‹œê°„ ìˆœì„œ)
    if (!isStateValid()) { // isStateValid()ëŠ” ë‚´ë¶€ ê·œì¹™ ê²€ì‚¬ ë©”ì„œë“œë¼ ê°€ì •
        throw new InvalidObjectException("ê°ì²´ ìƒíƒœ ê·œì¹™ ìœ„ë°˜!");
    }
    // ë°©ì–´ì  ë³µì‚¬ê°€ ì—†ìŒ!
}
```

### **ë¬¸ì œì :**

```mermaid
%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#f0f8ff', 'primaryTextColor': '#000', 'primaryBorderColor': '#7570b3', 'lineColor': '#333', 'edgeLabelBackground':'#fff', 'clusterBkg': '#fcfcfc'}}}%%
graph TD
    A["ìœ íš¨ì„± ê²€ì‚¬ë§Œ ìˆëŠ”<br>readObject"] -- ë§‰ì„ ìˆ˜ ìˆìŒ --> B["ê³µê²© 1 âœ…<br>(ê·œì¹™ ìœ„ë°˜ ê°ì²´ ìƒì„± ë°©ì§€)"];
    A -- ë§‰ì„ ìˆ˜ ì—†ìŒ --> C["ê³µê²© 2 âŒ<br>(ë‚´ë¶€ ì°¸ì¡° íƒˆì·¨/ìˆ˜ì • ê°€ëŠ¥)"];

    style B fill:#ccffcc,stroke:#0a0
    style C fill:#ffcccc,stroke:#a00
```

```mermaid
%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#f0f8ff', 'primaryTextColor': '#000', 'primaryBorderColor': '#7570b3', 'lineColor': '#333', 'edgeLabelBackground':'#fff', 'clusterBkg': '#fcfcfc'}}}%%
graph TD
    subgraph "ê³µê²© 2ê°€ ì—¬ì „íˆ ì„±ê³µí•˜ëŠ” ì´ìœ "
        direction LR
        C1[ì¡°ì‘ëœ ìŠ¤íŠ¸ë¦¼<br>+ ë‚´ë¶€ ì°¸ì¡°] --> C2{readObject ì‹¤í–‰<br>ìœ íš¨ì„± ê²€ì‚¬ í†µê³¼};
        C2 --> C3[ì •ìƒ ê°ì²´ ìƒì„±ë¨];
        C2 --> C4[ê³µê²©ì:<br>ë‚´ë¶€ ì°¸ì¡° íšë“ ì„±ê³µ!];
        C4 --> C5{ì™¸ë¶€ì—ì„œ<br>ë‚´ë¶€ ìƒíƒœ ìˆ˜ì •};
        C5 --> C6[ê°ì²´ ë¶ˆë³€ì„± ê¹¨ì§!];
    end

    style C6 fill:#ffcccc,stroke:#a00
```

### **ê³µê²© 1(ê·œì¹™ ìœ„ë°˜ ê°ì²´ ìƒì„±)ì€ ë°©ì–´ ê°€ëŠ¥**

* ê°ì²´ê°€ ìƒì„±ëœ í›„ ìƒíƒœë¥¼ ê²€ì‚¬í•˜ì—¬ ê·œì¹™ ìœ„ë°˜ ì‹œ ì˜ˆì™¸ë¥¼ ë˜ì§€ë¯€ë¡œ, ì˜ëª»ëœ ìƒíƒœì˜ ê°ì²´ê°€ ì™¸ë¶€ì— ë…¸ì¶œë˜ëŠ” ê²ƒì„ ë§‰ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### **ê³µê²© 2(ë‚´ë¶€ ìƒíƒœ ë³€ê²½)ëŠ” ë°©ì–´ ë¶ˆê°€**

* ê°ì²´ ìƒì„± ì‹œì ì˜ ìƒíƒœëŠ” ìœ íš¨í•˜ë”ë¼ë„, ê³µê²©ìëŠ” ì—¬ì „íˆ ê°ì²´ ë‚´ë¶€ì˜ ë³€ê²½ ê°€ëŠ¥í•œ ìš”ì†Œì— ëŒ€í•œ ì°¸ì¡°(`ë³µì œ ì—´ì‡ `)ë¥¼ íšë“í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì°¸ì¡°ë¥¼ í†µí•´ ë‚˜ì¤‘ì— ê°ì²´ ë‚´ë¶€ ìƒíƒœë¥¼ ë³€ê²½í•˜ëŠ” ê²ƒì„ ë§‰ì§€ ëª»í•©ë‹ˆë‹¤.

\
\


***

## 3. í•´ê²°ì±…: ë°©ì–´ì ì¸ `readObject` êµ¬í˜„ (3ë‹¨ê³„) ğŸ’¡

### **ëª©í‘œ:** ì–´ë–¤ ì¢…ë¥˜ì˜ ë°”ì´íŠ¸ ìŠ¤íŠ¸ë¦¼ì´ ì˜¤ë”ë¼ë„ ê°ì²´ì˜ ë¶ˆë³€ì‹(ê·œì¹™) ê³¼ ë¶ˆë³€ì„±(ìƒíƒœ)ì„ ëª¨ë‘ ì§€í‚¤ëŠ” ê²ƒ.

### **í•µì‹¬ ì „ëµ:** "ì¼ë‹¨ ì½ê³  â†’ ë‚´ë¶€ ë³´í˜¸(ë³µì‚¬) â†’ ìµœì¢… í™•ì¸(ê²€ì¦)"

```mermaid
%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#f0f8ff', 'primaryTextColor': '#000', 'primaryBorderColor': '#7570b3', 'lineColor': '#333', 'edgeLabelBackground':'#fff', 'clusterBkg': '#fcfcfc'}}}%%

flowchart TD
    subgraph "ì•ˆì „í•œ readObject() êµ¬í˜„"
        A[readObject ì‹œì‘] --> B["1.s.defaultReadObject<br>(ê¸°ë³¸ í•„ë“œ ì½ê¸°)"];
        B --> C["2.âœ¨ë°©ì–´ì  ë³µì‚¬âœ¨<br>ë‚´ë¶€ì˜ 'ë³€ê²½ ê°€ëŠ¥' ìš”ì†Œë“¤ì„<br>ìƒˆ ë³µì‚¬ë³¸ ê°ì²´ë¡œ êµì²´"];
        C --> D["3.âœ¨ìœ íš¨ì„± ê²€ì‚¬âœ¨<br>ë³µì‚¬ëœ 'ì•ˆì „í•œ' ë‚´ë¶€ ìƒíƒœ<br>ê¸°ì¤€ìœ¼ë¡œ ê°ì²´ ê·œì¹™ í™•ì¸"];
        D -- ê·œì¹™ ë§Œì¡± --> E["âœ… ê°ì²´ ë³µì› ì„±ê³µ"];
        D -- ê·œì¹™ ìœ„ë°˜ --> F["ğŸ’¥ InvalidObjectException ë˜ì§€ê¸°"];

        G[("ì™¸ë¶€ ì°¸ì¡° ê³µê²© ì‹œë„?")] -.->|ë³µì‚¬ë³¸ ì‚¬ìš©ìœ¼ë¡œ ì°¨ë‹¨!| C
        H[("TOCTOU ê³µê²© ì‹œë„?")] -.->|ë³µì‚¬ í›„ ê²€ì‚¬ë¡œ ì°¨ë‹¨!| D
    end

    style C fill:#ffe0e0,stroke:#333,stroke-width:2
    style D fill:#ffe0e0,stroke:#333,stroke-width:2
    style E fill:#ccffcc,stroke:#0a0
    style F fill:#ffcccc,stroke:#a00
    style G fill:#fff0f0,stroke:#a00,stroke-dasharray: 5 5
    style H fill:#fff0f0,stroke:#a00,stroke-dasharray: 5 5
```

### **êµ¬í˜„ ë‹¨ê³„:**

### 1. **`s.defaultReadObject();` í˜¸ì¶œ (1ë‹¨ê³„: ì½ê¸°):**

* ë¨¼ì € ìŠ¤íŠ¸ë¦¼ì—ì„œ ë°ì´í„°ë¥¼ ì½ì–´ `transient`ê°€ ì•„ë‹Œ í•„ë“œë“¤ ì±„ìš°ê¸°
* ì´ ì‹œì ì˜ ê°ì²´ ì°¸ì¡° í•„ë“œëŠ” ì™¸ë¶€ì™€ ê³µìœ ë  ìˆ˜ ìˆëŠ” ì ì¬ì  ìœ„í—˜ ìƒíƒœì¼ ìˆ˜ ìˆìŒ
  * íŠ¹íˆ ë³€ê²½ ê°€ëŠ¥í•œ íƒ€ì…

### 2. **ë‚´ë¶€ 'ë³€ê²½ ê°€ëŠ¥(Mutable)' í•„ë“œ ë°©ì–´ì  ë³µì‚¬ (2ë‹¨ê³„: ë³´í˜¸):**

#### **í•µì‹¬!**

* `defaultReadObject`ë¡œ ì½ì–´ì˜¨ í•„ë“œ ì¤‘, ë‚´ìš© ë³€ê²½ì´ ê°€ëŠ¥í•œ íƒ€ì…ì˜ ê°ì²´ë“¤ì€ **ë°˜ë“œì‹œ ìƒˆë¡œìš´ ë³µì‚¬ë³¸ ê°ì²´**ë¥¼ ë§Œë“¤ì–´ í•´ë‹¹ í•„ë“œì— **ë‹¤ì‹œ í• ë‹¹**
  * ë³€ê²½ ê°€ëŠ¥ íƒ€ì… ê°ì²´ ì˜ˆì‹œ: `Date`, `ArrayList`, ì§ì ‘ ë§Œë“  ê°€ë³€ í´ë˜ìŠ¤ ë“±
* `myMutableField = new MyMutableType(myMutableField); // ë˜ëŠ” ë³µì‚¬ ìƒì„±ì/ë©”ì„œë“œ ì‚¬ìš©`

#### **ì´ìœ **

* ê³µê²©ìê°€ ì›ë³¸ ê°ì²´ì˜ ì°¸ì¡°(`ë³µì œ ì—´ì‡ `)ë¥¼ í›”ì³¤ë”ë¼ë„, ìš°ë¦¬ ê°ì²´ ë‚´ë¶€ëŠ” ì´ì œ ì•ˆì „í•œ ë³µì‚¬ë³¸ì„ ì‚¬ìš©í•˜ë¯€ë¡œ ì™¸ë¶€ì˜ ìˆ˜ì • ì‹œë„ë¡œë¶€í„° ì•ˆì „í•´ì§‘ë‹ˆë‹¤. ì™¸ë¶€ì™€ì˜ ì°¸ì¡° ê³µìœ  ê³ ë¦¬ë¥¼ ëŠëŠ” íš¨ê³¼!

#### **ì£¼ì˜**

* ì´ ì¬í• ë‹¹ì„ ìœ„í•´ í•´ë‹¹ í•„ë“œëŠ” `final` í‚¤ì›Œë“œë¥¼ ê°€ì§ˆ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì´ëŠ” ì§ë ¬í™” ë³´ì•ˆì„ ìœ„í•œ ì–´ì©” ìˆ˜ ì—†ëŠ” íŠ¸ë ˆì´ë“œì˜¤í”„ì…ë‹ˆë‹¤.

### 3. **ê°ì²´ ìƒíƒœ ìœ íš¨ì„± ê²€ì‚¬ (3ë‹¨ê³„: í™•ì¸):**

* **ë°©ì–´ì ìœ¼ë¡œ ë³µì‚¬ëœ**, ì´ì œëŠ” ì•ˆì „í•˜ë‹¤ê³  í™•ì‹ í•  ìˆ˜ ìˆëŠ” ë‚´ë¶€ í•„ë“œë“¤ì„ ëŒ€ìƒìœ¼ë¡œ ê°ì²´ê°€ ì§€ì¼œì•¼ í•  ëª¨ë“  ë‚´ë¶€ ê·œì¹™(ë¶ˆë³€ì‹)ì„ ê²€ì‚¬í•©ë‹ˆë‹¤.
* `if (!isStateValid()) throw new InvalidObjectException(...);`
* **ì´ìœ :**
  * ì¡°ì‘ë˜ì§€ ì•Šì€, ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë‚´ë¶€ ìƒíƒœë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê·œì¹™ì„ ê²€ì¦í•©ë‹ˆë‹¤.
  * ë°©ì–´ì  ë³µì‚¬ **í›„ì—** ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•´ì•¼ ê²€ì‚¬ ì‹œì ê³¼ ì‚¬ìš© ì‹œì  ì‚¬ì´ì˜ ìƒíƒœ ë³€ê²½(Time-of-check to time-of-use, TOCTOU) ê³µê²©ì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### **ê°œë… ì˜ˆì‹œ (ë°©ì–´ì  `readObject`):**

```java
public final class SecureDataHolder implements Serializable {
    private transient MutableComponent internalState; // ë³€ê²½ ê°€ëŠ¥í•œ ë‚´ë¶€ ìš”ì†Œ
    private transient int cachedValue; // ê³„ì‚°ëœ ê°’

    // ìƒì„±ì ë“±ì€ ë‚´ë¶€ ê·œì¹™ê³¼ ë¶ˆë³€ì„±ì„ ë³´ì¥í•˜ë„ë¡ êµ¬í˜„ ê°€ì •...

    private void readObject(ObjectInputStream s) throws IOException, ClassNotFoundException {
        // 1ë‹¨ê³„: ì½ê¸°
        s.defaultReadObject();

        // 2ë‹¨ê³„: ë³´í˜¸ (ë°©ì–´ì  ë³µì‚¬)
        // - ìŠ¤íŠ¸ë¦¼ì—ì„œ ì½ì–´ì˜¨ internalState ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒˆ ë³µì‚¬ë³¸ ìƒì„±
        // - ì‹¤ì œë¡œëŠ” s.readObject() ë“±ìœ¼ë¡œ ì½ê³  ë³µì‚¬í•´ì•¼ í•  ìˆ˜ ìˆìŒ (Item 87 ë‚´ìš© ì°¸ê³ )
        // - ì—¬ê¸°ì„œëŠ” ê°œë…ì  í‘œí˜„:
        internalState = createDefensiveCopy(internalState); // ë°˜ë“œì‹œ í•„ìš”!

        // 3ë‹¨ê³„: í™•ì¸ (ìœ íš¨ì„± ê²€ì‚¬)
        if (!isValid(internalState)) { // ë‚´ë¶€ ê·œì¹™ ê²€ì‚¬
            throw new InvalidObjectException("ë‚´ë¶€ ìƒíƒœ ê·œì¹™ ìœ„ë°˜!");
        }

        // ì¶”ê°€: transient í•„ë“œ ë³µì› (í•„ìš”ì‹œ)
        cachedValue = calculateValue(internalState);
    }

    // ë°©ì–´ì  ë³µì‚¬ ë° ìœ íš¨ì„± ê²€ì‚¬, ê³„ì‚° ë©”ì„œë“œëŠ” ë³„ë„ êµ¬í˜„ ê°€ì •
    private MutableComponent createDefensiveCopy(MutableComponent original) { /*...*/ return new MutableComponent(original); }
    private boolean isValid(MutableComponent state) { /*...*/ return true; }
    private int calculateValue(MutableComponent state) { /*...*/ return 0; }

    // writeObjectë„ ë°©ì–´ì ìœ¼ë¡œ ì‘ì„± í•„ìš” (Item 87)
    // ... ë‚˜ë¨¸ì§€ ì½”ë“œ ...
}
```

### **ì¥ì :** ì•…ì˜ì ì¸ ë°”ì´íŠ¸ ìŠ¤íŠ¸ë¦¼ ê³µê²©ìœ¼ë¡œë¶€í„° ê°ì²´ì˜ ê·œì¹™ê³¼ ìƒíƒœë¥¼ ì•ˆì „í•˜ê²Œ ë³´í˜¸ ê°€ëŠ¥.

\
\


***

## 4. `readObject` ì‘ì„± ì‹œ ë°˜ë“œì‹œ ì§€ì¼œì•¼ í•  ê²ƒë“¤! ğŸ“Œ

### 1. **`readObject`ëŠ” `private`ìœ¼ë¡œ ì„ ì–¸í•˜ì„¸ìš”.**

* ì™¸ë¶€ì—ì„œ ì§ì ‘ í˜¸ì¶œí•  ìˆ˜ ì—†ë„ë¡
* ì§ë ¬í™” ì‹œìŠ¤í…œë§Œ í˜¸ì¶œ ê°€ëŠ¥

### 2. **ì–´ë–¤ ë°”ì´íŠ¸ ìŠ¤íŠ¸ë¦¼ì´ë“  ì²˜ë¦¬ ê°€ëŠ¥í•˜ê²Œ ë§Œë“œì„¸ìš”.**

* ì…ë ¥ ìŠ¤íŠ¸ë¦¼ì€ ë¹„ì •ìƒ ì§ë ¬í™” ë°ì´í„°ì¼ ìˆ˜ë„?
* ê³µê²© ê°€ëŠ¥ì„±ì„ ì—¼ë‘

### 3. **ëª¨ë“  'ë³€ê²½ ê°€ëŠ¥(Mutable)' ë‚´ë¶€ í•„ë“œëŠ” ë°©ì–´ì ìœ¼ë¡œ ë³µì‚¬í•˜ì„¸ìš”.** âœ¨

* ì—­ì§ë ¬í™” ì‹œ ì™¸ë¶€ì™€ ë‚´ë¶€ ìƒíƒœì˜ ì—°ê²° ê³ ë¦¬ë¥¼ ëŠëŠ” ê°€ì¥ ì¤‘ìš”í•œ ë‹¨ê³„
* í•´ë‹¹ í•„ë“œëŠ” `final`ì¼ ìˆ˜ ì—†ìŒ

### 4. **ìœ íš¨ì„± ê²€ì‚¬ëŠ” ë°©ì–´ì  ë³µì‚¬ 'ì´í›„'ì— ìˆ˜í–‰í•˜ì„¸ìš”.** âœ¨

* ì•ˆì „í•œ ë‚´ë¶€ ìƒíƒœë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ì‚¬, TOCTOU ê³µê²©ì„ ë°©ì§€
* ê·œì¹™ ìœ„ë°˜ ì‹œ `InvalidObjectException`ì„ ë˜ì ¸ ê°ì²´ ìƒì„±ì„ ì¤‘ë‹¨

### 5. **`readObject` ë‚´ì—ì„œ ì¬ì •ì˜ ê°€ëŠ¥í•œ(Overridable) ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì§€ ë§ˆì„¸ìš”!** ğŸš«

```mermaid
%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#f0f8ff', 'primaryTextColor': '#000', 'primaryBorderColor': '#7570b3', 'lineColor': '#333', 'edgeLabelBackground':'#fff', 'clusterBkg': '#fcfcfc'}}}%%
graph TD
    A["SuperClass.readObject()"] -- í˜¸ì¶œ --> B["overridableMethod()"];
    B -- ì¬ì •ì˜ë¨ --> C["SubClass.overridableMethod() ì‹¤í–‰!"];
    C --> D["ğŸ’¥ ì˜¤ë¥˜ ë°œìƒ ê°€ëŠ¥ì„±!<br>(SubClassì˜ í•„ë“œê°€ ì•„ì§<br>ì™„ì „íˆ ì´ˆê¸°í™”/ë³µì›ë˜ì§€<br>ì•Šì•˜ì„ ìˆ˜ ìˆìŒ)"];

    style D fill:#ffcccc,stroke:#a00
    style C fill:#fff0f0,stroke:#a00
```

#### **ì´ìœ **

* `readObject`ê°€ ì‹¤í–‰ë˜ëŠ” ì‹œì ì—ëŠ” ê°ì²´, íŠ¹íˆ í•˜ìœ„ í´ë˜ìŠ¤ì˜ ë¶ˆì™„ì „ ë³µì› ìƒíƒœ ê°€ëŠ¥ì„±
* ì´ë•Œ í•˜ìœ„ í´ë˜ìŠ¤ì—ì„œ ì¬ì •ì˜ëœ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ë©´, ë¶ˆì™„ì „í•œ ìƒíƒœì˜ ë¡œì§ì„ ìˆ˜í–‰í•˜ë ¤ë‹¤ ì˜ˆê¸°ì¹˜ ì•Šì€ ì˜¤ë¥˜ë‚˜ ìƒíƒœ ë¶ˆì¼ì¹˜ ìœ ë°œ ê°€ëŠ¥ (Item 19 ì›ì¹™ê³¼ ë™ì¼)

### 6. **ëª¨ë“  í•„ë“œë¥¼ ì§ì ‘ ì½ê³  ìœ íš¨ì„±ì„ ê²€ì‚¬í•´ì•¼ í•œë‹¤ë©´ `defaultReadObject`ë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.**

* í•˜ì§€ë§Œ `defaultReadObject`ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ìœ¼ë¡œ ë¯¸ë˜ì˜ í´ë˜ìŠ¤ ë³€ê²½ì— ë” ìœ ì—°í•˜ê²Œ ëŒ€ì²˜í•  ìˆ˜ ìˆìŒ
  * í•„ë“œ ì¶”ê°€ ë“±

### 7. **`ObjectInputValidation` ì¸í„°í˜ì´ìŠ¤ ì‚¬ìš©ì„ ê³ ë ¤í•˜ì„¸ìš”.**

* ê°œë³„ ê°ì²´ì˜ ìœ íš¨ì„±ë¿ ì•„ë‹ˆë¼, ì—­ì§ë ¬í™”ëœ ê°ì²´ ê·¸ë˜í”„ ì „ì²´ì˜ ì¼ê´€ì„±ì´ë‚˜ ìœ íš¨ì„±ì„ ê²€ì¦í•´ì•¼ í•  ë•Œ ìœ ìš©

\


***

## 5. í•µì‹¬ ì •ë¦¬ âœ¨

* `Serializable`ì„ êµ¬í˜„í•œ í´ë˜ìŠ¤ì˜ **ì—­ì§ë ¬í™” ê³¼ì •(`readObject`)** ì€ **ìƒì„±ìì™€ ë™ë“±í•˜ê±°ë‚˜ ê·¸ ì´ìƒì˜ ì£¼ì˜**ê°€ í•„ìš”í•œ **ê°ì²´ ìƒì„± ê²½ë¡œ**
* **ê¸°ë³¸ ì—­ì§ë ¬í™”ëŠ” ìƒì„±ìì˜ ì•ˆì „ì¥ì¹˜ë¥¼ ê±°ì¹˜ì§€ ì•Šìœ¼ë¯€ë¡œ**, ì•…ì˜ì ì¸ ë°”ì´íŠ¸ ìŠ¤íŠ¸ë¦¼ì— ì˜í•´ **ê°ì²´ ê·œì¹™ì´ ê¹¨ì§€ê±°ë‚˜ ë‚´ë¶€ ìƒíƒœê°€ ì™¸ë¶€ì—ì„œ ì¡°ì‘**ë  ìˆ˜ ìˆìŒ.
* ì•ˆì „í•œ ì—­ì§ë ¬í™”ë¥¼ ìœ„í•´ **ì»¤ìŠ¤í…€ `readObject`** ë¥¼ êµ¬í˜„í•˜ì—¬, **ë‚´ë¶€ì˜ ë³€ê²½ ê°€ëŠ¥ ìš”ì†ŒëŠ” ë°˜ë“œì‹œ ë°©ì–´ì ìœ¼ë¡œ ë³µì‚¬**í•˜ê³ , **ëª¨ë“  ê°ì²´ ê·œì¹™(ë¶ˆë³€ì‹)ì„ ë³µì‚¬ ì´í›„ì— ê²€ì¦**.
* `readObject` ë‚´ì—ì„œëŠ” **ì¬ì •ì˜ ê°€ëŠ¥ ë©”ì„œë“œ í˜¸ì¶œì„ í”¼í•˜ê¸°**
* `readObject`ë¥¼ ì‘ì„±í•˜ëŠ” ê²ƒì€ **ë°©ì–´ì  í”„ë¡œê·¸ë˜ë°**ì˜ ì¤‘ìš”í•œ ì‹¤ì²œ -> **ì ˆëŒ€ ì…ë ¥ì„ ì‹ ë¢°í•˜ì§€ ì•Šê¸°.**
