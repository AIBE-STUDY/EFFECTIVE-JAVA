# ğŸ“˜ ì´í™í‹°ë¸Œ ìë°” ìŠ¤í„°ë””

## ğŸ“ ì•„ì´í…œ 8: finalizerì™€ cleaner ì‚¬ìš©ì„ í”¼í•˜ë¼

### ğŸ”¹ ìš”ì•½

âœ… `finalizer`ì™€ `cleaner`ë¥¼ ìœ ìš©í•˜ê²Œ ì‚¬ìš©í•  ì¼ì€ ê·¹íˆ ë“œë¬¼ë‹¤

- ì•ˆì „ë§ ì—­í• ë¡œ ìì›ì„ ë°˜ë‚©í•˜ê³ ì í•˜ëŠ” ê²½ìš°
- ë„¤ì´í‹°ë¸Œ ìì›ë¥¼ ì •ë¦¬í•´ì•¼ í•˜ëŠ” ê²½ìš°

âœ… `finalizer`ì™€ `cleaner`ëŠ” ìˆ˜í–‰ì„ ë³´ì¥í•  ìˆ˜ ì—†ë‹¤

- ì „ì ìœ¼ë¡œ `GC(ê°€ë¹„ì§€ ì»¬ë ‰í„°)` ì•Œê³ ë¦¬ì¦˜ì— ë‹¬ë ¤ìˆìœ¼ë©° GCë§ˆë‹¤ ë‹¤ë¥´ë‹¤
- í…ŒìŠ¤íŠ¸í•œ JVMì—ì„  ì™„ë²½í•˜ê²Œ ë™ì‘í•˜ì—¬ë„ ê³ ê°ì˜ ì‹œìŠ¤í…œì—ì„  ë‹¤ë¥´ê²Œ ë™ì‘í•  ê°€ëŠ¥ì„±ì´ ë§¤ìš° ë†’ë‹¤ë‹¤

âœ… `finalizer`ì™€ `cleaner`ëŠ” ìš°ì„  ìˆœìœ„ê°€ ë‚®ë‹¤

- Finalizer ì“°ë ˆë“œëŠ” ìš°ì„ ìˆœìœ„ê°€ ë‚®ì•„ì„œ ì‹¤í–‰ë  ê¸°íšŒë¥¼ ì–»ì§€ ëª» í•  ìˆ˜ë„ ìˆë‹¤
- ì²˜ë¦¬ë˜ì§€ ëª»í•œ ê°ì²´ê°€ ìŒ“ì¼ ê²½ìš° `OutOfMemoryError`ê°€ ë°œìƒë  ìˆ˜ ìˆë‹¤

---

### ğŸ“š ì¶”ê°€ ê°œë…

ğŸ’¡ **vs C++ destructor**

- **C++ì˜ Destructor**ëŠ” ê°ì²´ê°€ ì†Œë©¸ë  ë•Œ í˜¸ì¶œë˜ë©°, ê°ì²´ì™€ ê´€ë ¨ëœ ìì›ì„ ë°˜ë‚©í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.  
  C++ì—ì„œëŠ” ê°ì²´ê°€ ìŠ¤ì½”í”„ë¥¼ ë²—ì–´ë‚˜ê±°ë‚˜ `delete`ë¡œ ë©”ëª¨ë¦¬ í• ë‹¹ì„ í•´ì œí•  ë•Œ ìë™ìœ¼ë¡œ í˜¸ì¶œë©ë‹ˆë‹¤.
- **Javaì—ì„œëŠ” `try-with-resources`** êµ¬ë¬¸ì´ë‚˜ **`try-finally`** ë¸”ë¡ì´ ìì›ì„ ê´€ë¦¬í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.  
  `AutoCloseable` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ì˜ ê²½ìš°, `try-with-resources` êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ ìì›ì„ ìë™ìœ¼ë¡œ ë‹«ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì›ì„ í•´ì œí•˜ë ¤ë©´ **ëª…ì‹œì ìœ¼ë¡œ `close()` ë©”ì„œë“œë¥¼ í˜¸ì¶œ**í•˜ê±°ë‚˜, `try-with-resources` ë¸”ë¡ì„ ì‚¬ìš©í•˜ì—¬ ìë™ìœ¼ë¡œ í˜¸ì¶œë˜ë„ë¡ í•©ë‹ˆë‹¤.
- **C++**: DestructorëŠ” ê°ì²´ ì†Œë©¸ ì‹œ ìì›ì„ ë°˜ë‚©í•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰.
- **Java**: `AutoCloseable` ì¸í„°í˜ì´ìŠ¤ì™€ `try-with-resources`ë¥¼ í†µí•´ ëª…ì‹œì  ìì› ê´€ë¦¬ê°€ ì´ë£¨ì–´ì§„ë‹¤.

#### ğŸ’¡ **ë„¤ì´í‹°ë¸Œ í”¼ì–´(Native Peer)ë€?**

- **ë„¤ì´í‹°ë¸Œ í”¼ì–´(Native Peer)** ëŠ” **Java ê°ì²´** ê°€ ì•„ë‹ˆë¼, **ë„¤ì´í‹°ë¸Œ ë©”ì†Œë“œ**ë¥¼ í†µí•´ Java ê°ì²´ì™€ ì—°ê²°ëœ **ë„¤ì´í‹°ë¸Œ ê°ì²´** ì…ë‹ˆë‹¤. ì¦‰, **Java Application** ì—ì„œ **C, C++** ì™€ ê°™ì€ ë„¤ì´í‹°ë¸Œ ì–¸ì–´ë¡œ ì‘ì„±ëœ ì½”ë“œì™€ ìƒí˜¸ì‘ìš©í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ê°ì²´ì…ë‹ˆë‹¤.  
  ì´ ê°ì²´ëŠ” **Java ê°€ë¹„ì§€ ì»¬ë ‰í„°(GC)** ì˜ ì¶”ì ì„ ë°›ì§€ ì•Šê¸° ë•Œë¬¸ì—, **Java í™** ì—ì„œ ê´€ë¦¬ë˜ì§€ ì•Šê³ , ìë™ìœ¼ë¡œ ë©”ëª¨ë¦¬ ê´€ë¦¬ê°€ ì´ë£¨ì–´ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.

- **ë„¤ì´í‹°ë¸Œ ë©”ì†Œë“œ** ë€ **Java** ì—ì„œ **C, C++** ë¡œ ì‘ì„±ëœ ë„¤ì´í‹°ë¸Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ê¸°ëŠ¥ì„ í˜¸ì¶œí•˜ê¸° ìœ„í•œ ë©”ì†Œë“œì…ë‹ˆë‹¤. Javaì—ì„œëŠ” `native` í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì„ ì–¸í•˜ê³ , ì´ë¥¼ í†µí•´ ë„¤ì´í‹°ë¸Œ ì½”ë“œë¡œ ì •ì˜ëœ ë©”ì†Œì†Œë“œë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë©”ì†Œë“œëŠ” **JNI(Java Native Interface)**ë¥¼ í†µí•´ ì—°ê²°ë©ë‹ˆë‹¤.

- **GC(ê°€ë¹„ì§€ ì»¬ë ‰í„°)**ëŠ” Java í™ì—ì„œ ê´€ë¦¬ë˜ëŠ” ê°ì²´ë§Œ ì¶”ì í•˜ê³ , ë„¤ì´í‹°ë¸Œ í”¼ì–´ì™€ ê°™ì€ **ë„¤ì´í‹°ë¸Œ ê°ì²´** ëŠ” ê´€ë¦¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ë„¤ì´í‹°ë¸Œ í”¼ì–´ëŠ” ìë™ìœ¼ë¡œ ìì› í•´ì œë¥¼ í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, **`finalizer`**ë‚˜ **`close()`** ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ëª…ì‹œì ìœ¼ë¡œ ìì›ì„ í•´ì œí•´ì•¼ í•©ë‹ˆë‹¤. ì´ë•Œ **finalizer**ëŠ” Java ê°ì²´ê°€ ì†Œë©¸ë  ë•Œ ìì›ì„ í•´ì œí•˜ëŠ” ë°©ë²•ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.

- **`ë„¤ì´í‹°ë¸Œ ë©”ì†Œë“œ finalizer` êµ¬ë¬¸ ì˜ˆì‹œ**:

  ```java
  public class FinalizeExample {
    // ìì› í•´ì œ ë©”ì†Œë“œë“œ
    private void releaseResource() {
        System.out.println("ìì› í•´ì œ");
    }

    // finalize ë©”ì„œë“œì—ì„œ ìì› í•´ì œ
    @Override
    protected void finalize() throws Throwable {
        try {
            releaseResource(); // ìì› í•´ì œ
        } finally {
            super.finalize(); // ë¶€ëª¨ í´ë˜ìŠ¤(Object) finalize í˜¸ì¶œ
        }
    }

    public static void main(String[] args) {
        FinalizeExample example = new FinalizeExample();
        example = null;  // ê°ì²´ë¥¼ nullë¡œ ì„¤ì •í•˜ì—¬ ê°€ë¹„ì§€ ì»¬ë ‰í„°ê°€ finalizeë¥¼ í˜¸ì¶œí•˜ë„ë¡ í•¨
        System.gc();  // ê°•ì œë¡œ ê°€ë¹„ì§€ ì»¬ë ‰í„° ì‹¤í–‰ -> finalize ë™ì‘
    }
  }
  ```

#### ğŸ’¡ **[AutoCloseable](https://www.geeksforgeeks.org/closeable-interface-in-java/)ì´ë€?**

- **`AutoCloseable`** ì€ ìì›ì„ ìë™ìœ¼ë¡œ ë‹«ì„ ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤.  
  ì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ ê°ì²´ëŠ” **`try-with-resources`** êµ¬ë¬¸ì—ì„œ ì‚¬ìš©ë˜ì–´, ìì›ì„ ìë™ìœ¼ë¡œ í•´ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **`AutoCloseable`** ì¸í„°í˜ì´ìŠ¤ëŠ” **`close()`** ë©”ì„œë“œë¥¼ ì •ì˜í•˜ê³  ìˆìŠµë‹ˆë‹¤.  
  ì´ ë©”ì„œë“œëŠ” ìì›ì„ ë‹«ëŠ” ë° ì‚¬ìš©ë˜ë©°, íŒŒì¼, ë„¤íŠ¸ì›Œí¬ ì—°ê²°, ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë“±ê³¼ ê°™ì€ ìì› ê´€ë¦¬ì— í™œìš©ë©ë‹ˆë‹¤.

- `AutoCloseable`ì„ êµ¬í˜„í•˜ë©´, ê°ì²´ê°€ ë” ì´ìƒ í•„ìš”í•˜ì§€ ì•Šì„ ë•Œ **ëª…ì‹œì ìœ¼ë¡œ `close()`** ë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.  
  **`try-with-resources`** êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ë©´, ë¸”ë¡ì„ ë²—ì–´ë‚  ë•Œ ìë™ìœ¼ë¡œ `close()` ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì–´ ìì›ì„ ì •ë¦¬í•©ë‹ˆë‹¤.

- **ì£¼ìš” ì‚¬ìš© ì˜ˆì‹œ**:

  - íŒŒì¼ ì…ì¶œë ¥ (ì˜ˆ: `FileInputStream`, `BufferedReader`)
  - ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° (ì˜ˆ: `Connection`, `Statement`)
  - ì‚¬ìš©ì ì…ë ¥ (ì˜ˆ: `Scanner`)

- **`try-with-resources` êµ¬ë¬¸ ì˜ˆì‹œ**:
  ```java
  try (BufferedReader br = new BufferedReader(new FileReader("example.txt"))) {
      // íŒŒì¼ ì½ê¸° ì‘ì—…
  } catch (IOException e) {
      e.printStackTrace();
  }
  // try-with-resources ë¸”ë¡ì„ ë²—ì–´ë‚˜ë©´ ìë™ìœ¼ë¡œ close() í˜¸ì¶œ
  ```

---

### ğŸ¯ ì¤‘ìš”í•œ ì 

ğŸ“Œ **`finalizer`ëŠ” ì˜ˆì¸¡ì´ ë¶ˆê°€ëŠ¥í•˜ê³ , ìœ„í—˜í•˜ë©°, ë¶ˆí•„ìš”í•˜ë‹¤**  
ğŸ“Œ **ë³„ë„ì˜ ì“°ë ˆë“œë¥¼ ì‚¬ìš©í•˜ëŠ” `cleaner`ë„ `finalizer`ë³´ë‹¤ ëœ ìœ„í—˜í•˜ì§€ë§Œ ì—¬ì „íˆ ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•˜ê³ , ëŠë¦¬ê³ , ë¶ˆí•„ìš”í•˜ë‹¤**  
ğŸ“Œ **`AutoCloseable`ì„ êµ¬í˜„í•˜ì—¬ ìì› ì‚¬ìš© í›„ ëª…ì‹œì ìœ¼ë¡œ close() ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ê±°ë‚˜, `try-with-resources` êµ¬ë¬¸ì„ í†µí•´ ìì›ì„ ìë™ìœ¼ë¡œ ê´€ë¦¬í•˜ì.**

---

### ğŸ’¡ ì½”ë“œ ì˜ˆì œ ë° ì„¤ëª…

#### âŒ ì˜ëª»ëœ ì˜ˆì œ (`finalizer`ë¥¼ ì‚¬ìš©í•œ ê²½ìš°)

```java
public class SampleRunner {
    public static void main(String[] args) {
        SampleRunner runner = new SampleRunner();
        runner.run(); //  run() ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ FinalizerExample ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì‚¬ìš©
        Thread.sleep(1000); // 1ì´ˆí›„ "Clean up" ì¶œë ¥ë  ì§€ ì•„ë¬´ë„ ëª¨ë¥¸ë‹¤.

        // run() ë©”ì„œë“œê°€ ì¢…ë£Œë˜ë©´ finalizerExample ê°ì²´ëŠ” ë” ì´ìƒ ì°¸ì¡°ë˜ì§€ ì•Šì•„ GCì˜ ëŒ€ìƒì´ ë¨
        // ê·¸ëŸ¬ë‚˜ GCì™€ finalize() ë©”ì„œë“œ í˜¸ì¶œ ì‹œì ì€ JVMì— ì˜í•´ ê²°ì •ë˜ë¯€ë¡œ ì‹¤í–‰ì´ ë³´ì¥ë˜ì§€ ì•ŠìŒ
    }

    private void run() {
        FinalizerExample finalizerExample = new FinalizerExample();
        finalizerExample.hello();

        // ì´ ë©”ì„œë“œê°€ ì¢…ë£Œë˜ë©´ finalizerExample ë³€ìˆ˜ëŠ” ìŠ¤ì½”í”„ë¥¼ ë²—ì–´ë‚˜ ì°¸ì¡°ê°€ ëŠì–´ì§
        // ì´ì œ ì´ ê°ì²´ëŠ” GCì˜ ëŒ€ìƒì´ ë¨
    }
}

public class FinalizerExample {

    @Override
    protected void finalize() throws Throwable {
        System.out.println("Clean up");
    }

    public void hello() {
         System.out.println("Hello");
    }
}
```

#### âœ… ê°œì„ ëœ ì˜ˆì œ (`AutoCloseable`ë¥¼ ì‚¬ìš©í•œ ê²½ìš°)

```java
public static void main(String[] args) {
    SampleResource sampleResource = null;
    try {
        sampleResource = new SampleResource();
        sampleResource.hello();
    } finally {
        // finally ë¸”ë¡ì€ ì˜ˆì™¸ ë°œìƒ ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´ í•­ìƒ ì‹¤í–‰ë¨
        if (sampleResource != null) {
            sampleResource.close();
        }
    }
    // try-with-resources êµ¬ë¬¸ì´ ë„ì…ë˜ê¸° ì „ì— ì£¼ë¡œ ì‚¬ìš©ë˜ë˜ ë°©ì‹
}

// AutoCloseable ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤
public class SampleResource implements AutoCloseable {

    @Override
    public void close() throws RuntimeException {
        // ìì›ì„ í•´ì œí•˜ëŠ” ë©”ì†Œë“œ
        System.out.println("close");
    }

    public void hello() {
        System.out.println("Hello");
    }
}
```

#### âœ… ê°œì„ ëœ ì˜ˆì œ2 (`AutoCloseable`ì™€ `try-with-resources`ë¥¼ í•¨ê»˜ ì‚¬ìš©í•œ ê²½ìš°)

```java
public static void main(String[] args) {

    // ë¸”ë¡ì´ ì¢…ë£Œë˜ë©´ ìë™ìœ¼ë¡œ close() ë©”ì„œë“œê°€ í˜¸ì¶œë¨
    // ì˜ˆì™¸ê°€ ë°œìƒí•˜ë”ë¼ë„ close()ëŠ” ë°˜ë“œì‹œ í˜¸ì¶œë¨
    try(SampleResource sampleResource = new SampleResource()) {
        sampleResource.hello();
    }
}

// AutoCloseable ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤
public class SampleResource implements AutoCloseable {

    @Override
    public void close() throws RuntimeException {
        // ìì›ì„ í•´ì œí•˜ëŠ” ë©”ì†Œë“œ
        System.out.println("close");
    }

    public void hello() {
        System.out.println("Hello");
    }
}
```

---

### â— ì–´ë ¤ì› ë˜ ì 

âš ï¸ `AutoCloseable`ì„ ì²˜ìŒ ì ‘í•´ë´¤ë‹¤. ê·¸ëŸ°ë° ë‚˜ë„ ëª¨ë¥´ëŠ” ì‚¬ì´ì— `AutoCloseable`ì´ êµ¬í˜„ëœ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê³  ìˆì—ˆë‹¤.

âš ï¸ Java ê²½í—˜ì´ ëª¨ë˜í•˜ì§€ ì•Šì•„ì„œ `cleaner`ì™€ `finalizer`ë¼ëŠ” ê±¸ ì²˜ìŒ ì ‘í•´ë´¤ë‹¤.

âš ï¸ `ë„¤ì´í‹°ë¸Œ ë©”ì†Œë“œ` ê°œë…ì„ ë“¤ì–´ëŠ” ë´¤ëŠ”ë° íŠ¹ì„±ì„ ëª°ëë‹¤.

---

### ğŸ’­ ëŠë‚€ ì 

ğŸ’¡ `finalizerì™€ cleaner`ì˜ ì¡´ì¬ë¥¼ ëª¨ë¥´ê³  ì‚¬ìš©í•´ì™”ëŠ”ë°, `GC(ê°€ë¹„ì§€ ì»¬ë ‰í„°)`ê°€ ì–¸ì œ ê°ì²´ë¥¼ ì •ë¦¬í• ì§€ëŠ” ì˜ˆì¸¡í•  ìˆ˜ ìˆë‹¤ëŠ” ê±´ ì•Œì•˜ì§€ë§Œ, **ì´ë ‡ê²Œ ë¶ˆí™•ì‹¤í•  ì¤„ì€ ëª°ëë‹¤.**

ğŸ’¡ `ë„¤ì´í‹°ë¸Œ í”¼ì–´`ì²˜ëŸ¼ **`GC(ê°€ë¹„ì§€ ì»¬ë ‰í„°)`ê°€ ì§ì ‘ ê´€ë¦¬í•˜ì§€ ì•ŠëŠ” ìì›ë„ ì¡´ì¬í•˜ë¯€ë¡œ, ìì› í•´ì œë¥¼ ë°˜ë“œì‹œ ê³ ë ¤í•´ì•¼ í•œë‹¤.**

ğŸ’¡ ìë°”ì—ì„œë„ **ë©”ëª¨ë¦¬ ê´€ë¦¬ì˜ ì±…ì„ì€ ê°œë°œì**ì—ê²Œ ìˆë‹¤!
